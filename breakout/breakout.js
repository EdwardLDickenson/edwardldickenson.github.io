var levelOne = [{"dimensions":[600,600,40,20,80,20,2,5,6]},{"type":1,"hits":1,"x":0,"y":20},{"type":1,"hits":1,"x":0,"y":0},{"type":1,"hits":1,"x":0,"y":60},{"type":1,"hits":1,"x":0,"y":80},{"type":1,"hits":1,"x":0,"y":40},{"type":1,"hits":1,"x":0,"y":100},{"type":1,"hits":1,"x":0,"y":140},{"type":1,"hits":1,"x":0,"y":120},{"type":1,"hits":1,"x":0,"y":160},{"type":1,"hits":1,"x":0,"y":200},{"type":1,"hits":1,"x":0,"y":220},{"type":1,"hits":1,"x":0,"y":180},{"type":1,"hits":1,"x":40,"y":220},{"type":1,"hits":1,"x":40,"y":200},{"type":1,"hits":1,"x":40,"y":180},{"type":1,"hits":1,"x":40,"y":160},{"type":1,"hits":1,"x":40,"y":140},{"type":1,"hits":1,"x":40,"y":100},{"type":1,"hits":1,"x":40,"y":60},{"type":1,"hits":1,"x":40,"y":20},{"type":1,"hits":1,"x":40,"y":0},{"type":1,"hits":1,"x":40,"y":80},{"type":1,"hits":1,"x":40,"y":40},{"type":1,"hits":1,"x":40,"y":120},{"type":1,"hits":1,"x":80,"y":0},{"type":1,"hits":1,"x":80,"y":40},{"type":1,"hits":1,"x":80,"y":80},{"type":1,"hits":1,"x":80,"y":140},{"type":1,"hits":1,"x":80,"y":200},{"type":1,"hits":1,"x":80,"y":220},{"type":1,"hits":1,"x":80,"y":180},{"type":1,"hits":1,"x":80,"y":160},{"type":1,"hits":1,"x":80,"y":120},{"type":1,"hits":1,"x":80,"y":100},{"type":1,"hits":1,"x":80,"y":60},{"type":1,"hits":1,"x":80,"y":20},{"type":1,"hits":1,"x":120,"y":0},{"type":1,"hits":1,"x":120,"y":20},{"type":1,"hits":1,"x":120,"y":40},{"type":1,"hits":1,"x":120,"y":60},{"type":1,"hits":1,"x":120,"y":80},{"type":1,"hits":1,"x":120,"y":100},{"type":1,"hits":1,"x":120,"y":120},{"type":1,"hits":1,"x":120,"y":140},{"type":1,"hits":1,"x":120,"y":160},{"type":1,"hits":1,"x":120,"y":180},{"type":1,"hits":1,"x":120,"y":200},{"type":1,"hits":1,"x":120,"y":220},{"type":1,"hits":1,"x":160,"y":220},{"type":1,"hits":1,"x":200,"y":220},{"type":1,"hits":1,"x":240,"y":220},{"type":1,"hits":1,"x":280,"y":220},{"type":1,"hits":1,"x":320,"y":220},{"type":1,"hits":1,"x":360,"y":220},{"type":1,"hits":1,"x":400,"y":220},{"type":1,"hits":1,"x":440,"y":220},{"type":1,"hits":1,"x":480,"y":220},{"type":1,"hits":1,"x":520,"y":220},{"type":1,"hits":1,"x":560,"y":220},{"type":1,"hits":1,"x":560,"y":200},{"type":1,"hits":1,"x":520,"y":200},{"type":1,"hits":1,"x":480,"y":200},{"type":1,"hits":1,"x":440,"y":200},{"type":1,"hits":1,"x":400,"y":200},{"type":1,"hits":1,"x":360,"y":200},{"type":1,"hits":1,"x":320,"y":200},{"type":1,"hits":1,"x":280,"y":200},{"type":1,"hits":1,"x":240,"y":200},{"type":1,"hits":1,"x":200,"y":200},{"type":1,"hits":1,"x":160,"y":200},{"type":1,"hits":1,"x":160,"y":180},{"type":1,"hits":1,"x":200,"y":180},{"type":1,"hits":1,"x":240,"y":180},{"type":1,"hits":1,"x":280,"y":180},{"type":1,"hits":1,"x":320,"y":180},{"type":1,"hits":1,"x":360,"y":180},{"type":1,"hits":1,"x":400,"y":180},{"type":1,"hits":1,"x":440,"y":180},{"type":1,"hits":1,"x":480,"y":180},{"type":1,"hits":1,"x":520,"y":180},{"type":1,"hits":1,"x":560,"y":180},{"type":1,"hits":1,"x":560,"y":160},{"type":1,"hits":1,"x":520,"y":160},{"type":1,"hits":1,"x":480,"y":160},{"type":1,"hits":1,"x":400,"y":160},{"type":1,"hits":1,"x":440,"y":160},{"type":1,"hits":1,"x":360,"y":160},{"type":1,"hits":1,"x":320,"y":160},{"type":1,"hits":1,"x":280,"y":160},{"type":1,"hits":1,"x":240,"y":160},{"type":1,"hits":1,"x":200,"y":160},{"type":1,"hits":1,"x":160,"y":160},{"type":1,"hits":1,"x":160,"y":140},{"type":1,"hits":1,"x":200,"y":140},{"type":1,"hits":1,"x":240,"y":140},{"type":1,"hits":1,"x":280,"y":140},{"type":1,"hits":1,"x":320,"y":140},{"type":1,"hits":1,"x":360,"y":140},{"type":1,"hits":1,"x":400,"y":140},{"type":1,"hits":1,"x":440,"y":140},{"type":1,"hits":1,"x":480,"y":140},{"type":1,"hits":1,"x":520,"y":140},{"type":1,"hits":1,"x":560,"y":140},{"type":1,"hits":1,"x":560,"y":120},{"type":1,"hits":1,"x":520,"y":120},{"type":1,"hits":1,"x":480,"y":120},{"type":1,"hits":1,"x":440,"y":120},{"type":1,"hits":1,"x":400,"y":120},{"type":1,"hits":1,"x":360,"y":120},{"type":1,"hits":1,"x":320,"y":120},{"type":1,"hits":1,"x":280,"y":120},{"type":1,"hits":1,"x":240,"y":120},{"type":1,"hits":1,"x":200,"y":120},{"type":1,"hits":1,"x":160,"y":120},{"type":1,"hits":1,"x":160,"y":100},{"type":1,"hits":1,"x":200,"y":100},{"type":1,"hits":1,"x":240,"y":100},{"type":1,"hits":1,"x":280,"y":100},{"type":1,"hits":1,"x":320,"y":100},{"type":1,"hits":1,"x":360,"y":100},{"type":1,"hits":1,"x":400,"y":100},{"type":1,"hits":1,"x":440,"y":100},{"type":1,"hits":1,"x":480,"y":100},{"type":1,"hits":1,"x":520,"y":100},{"type":1,"hits":1,"x":560,"y":100},{"type":1,"hits":1,"x":560,"y":80},{"type":1,"hits":1,"x":520,"y":80},{"type":1,"hits":1,"x":480,"y":80},{"type":1,"hits":1,"x":440,"y":80},{"type":1,"hits":1,"x":400,"y":80},{"type":1,"hits":1,"x":360,"y":80},{"type":1,"hits":1,"x":320,"y":80},{"type":1,"hits":1,"x":280,"y":80},{"type":1,"hits":1,"x":240,"y":80},{"type":1,"hits":1,"x":200,"y":80},{"type":1,"hits":1,"x":160,"y":80},{"type":1,"hits":1,"x":160,"y":40},{"type":1,"hits":1,"x":200,"y":60},{"type":1,"hits":1,"x":240,"y":60},{"type":1,"hits":1,"x":160,"y":60},{"type":1,"hits":1,"x":200,"y":40},{"type":1,"hits":1,"x":240,"y":40},{"type":1,"hits":1,"x":280,"y":60},{"type":1,"hits":1,"x":280,"y":40},{"type":1,"hits":1,"x":320,"y":60},{"type":1,"hits":1,"x":360,"y":60},{"type":1,"hits":1,"x":400,"y":60},{"type":1,"hits":1,"x":440,"y":60},{"type":1,"hits":1,"x":480,"y":60},{"type":1,"hits":1,"x":520,"y":60},{"type":1,"hits":1,"x":560,"y":60},{"type":1,"hits":1,"x":560,"y":40},{"type":1,"hits":1,"x":520,"y":40},{"type":1,"hits":1,"x":440,"y":40},{"type":1,"hits":1,"x":360,"y":40},{"type":1,"hits":1,"x":320,"y":40},{"type":1,"hits":1,"x":400,"y":40},{"type":1,"hits":1,"x":480,"y":40},{"type":1,"hits":1,"x":560,"y":20},{"type":1,"hits":1,"x":560,"y":0},{"type":1,"hits":1,"x":520,"y":20},{"type":1,"hits":1,"x":520,"y":0},{"type":1,"hits":1,"x":480,"y":0},{"type":1,"hits":1,"x":480,"y":20},{"type":1,"hits":1,"x":440,"y":20},{"type":1,"hits":1,"x":440,"y":0},{"type":1,"hits":1,"x":400,"y":0},{"type":1,"hits":1,"x":400,"y":20},{"type":1,"hits":1,"x":360,"y":20},{"type":1,"hits":1,"x":360,"y":0},{"type":1,"hits":1,"x":320,"y":0},{"type":1,"hits":1,"x":320,"y":20},{"type":1,"hits":1,"x":280,"y":20},{"type":1,"hits":1,"x":280,"y":0},{"type":1,"hits":1,"x":240,"y":0},{"type":1,"hits":1,"x":240,"y":20},{"type":1,"hits":1,"x":200,"y":20},{"type":1,"hits":1,"x":200,"y":0},{"type":1,"hits":1,"x":160,"y":0},{"type":1,"hits":1,"x":160,"y":20},{"type":1,"hits":1,"x":0,"y":240},{"type":1,"hits":1,"x":40,"y":240},{"type":1,"hits":1,"x":120,"y":240},{"type":1,"hits":1,"x":80,"y":240},{"type":1,"hits":1,"x":160,"y":240},{"type":1,"hits":1,"x":200,"y":240},{"type":1,"hits":1,"x":240,"y":240},{"type":1,"hits":1,"x":280,"y":240},{"type":1,"hits":1,"x":320,"y":240},{"type":1,"hits":1,"x":360,"y":240},{"type":1,"hits":1,"x":400,"y":240},{"type":1,"hits":1,"x":480,"y":240},{"type":1,"hits":1,"x":520,"y":240},{"type":1,"hits":1,"x":560,"y":240},{"type":1,"hits":1,"x":440,"y":240}];

var levels = [levelOne];

//	These are just the default values incase the array does not load for some reason
var canvasWidth = 600;
var canvasHeight = 600;
var blockWidth = 40;
var blockHeight = 20;
var paddleWidth = 80;
var paddleHeight = 20;

var levelDimensions = [];
var blocks = [];
var levelName = "";

var timer;

var paddle = {"xv": 0};
var ball = {"xv": 0, "yv": 0};
var shouldLoadLevel = true;
var context;

document.onkeydown = kvent;

function kvent(evt)
{
	if(evt.keyCode == '37')
	{
		console.log("left arrow");
		paddle.xv -= levelDimensions[6];
	}

	if(evt.keyCode == '39')
	{
		console.log("right arrow");
		paddle.xv += levelDimensions[6];
	}
}

function renderRect(x, y, width, height, str)
{
	context.beginPath();
	context.rect(x, y, width, height);
	context.fillStyle = str;
	context.fill();
	context.closePath();
}

function renderType(x, y, n)
{
	if(n == 1)
	{
		renderRect(x, y, levelDimensions[2], levelDimensions[3], "#FF0000");
		renderRect(x + 4, y + 4, levelDimensions[2] - 8, levelDimensions[3] - 8, "#880000");
	}

	if(n == 2)
	{
		renderRect(x, y, levelDimensions[2], levelDimensions[3], "#00FF00");
		renderRect(x + 4, y + 4, levelDimensions[2] - 8, levelDimensions[3] - 8, "#008800");
	}

	if(n == 3)
	{
		renderRect(x, y, levelDimensions[2], levelDimensions[3], "#0000FF");
		renderRect(x + 4, y + 4, levelDimensions[2] - 8, levelDimensions[3] - 8, "#000088");
	}
}

function render()
{
	fillScreen("#FFFFFF");

	renderRect(paddle.x, paddle.y, levelDimensions[4], levelDimensions[5], "#FF00FF");

	for(var i = 0; i < blocks.length; ++i)
	{
		renderType(blocks[i].x, blocks[i].y, blocks[i].type);
	}
}

function collisionRectWall(x, y, w, h)
{
	if(x < 0 || y < 0 || x > levelDimensions[0] || y + h > levelDimensions[1])
	{
		return true;
	}

	return false;
}

function move()
{
	if(!collisionRectWall(paddle.x, paddle.y, levelDimensions[4], levelDimensions[5]) &&
		!collisionRectWall(paddle.x + paddle.xv, paddle.y, levelDimensions[4], levelDimensions[5]))
	{
		paddle.x += paddle.xv;
	}

	else
	{
		paddle.xv = 0;
	}
}

function main()
{
	render();
	move();

	//	Pull information from the level array
	if(shouldLoadLevel)
	{
		var level = levels[0];

		//	Level dimensions
		levelDimensions.push(600);
		levelDimensions.push(600);
		levelDimensions.push(level[0]["dimensions"][2]);
		levelDimensions.push(level[0]["dimensions"][3]);
		levelDimensions.push(level[0]["dimensions"][4]);
		levelDimensions.push(level[0]["dimensions"][5]);
		levelDimensions.push(level[0]["dimensions"][6]);
		levelDimensions.push(level[0]["dimensions"][7]);
		levelDimensions.push(level[0]["dimensions"][8]);

		//	Now pull the blocks from the level data as well
		for(var i = 1; i < levelOne.length; ++i)
		{
			var block = {};
			block.type = levelOne[i].type;
			block.hits = levelOne[i].hits;
			block.x = levelOne[i].x;
			block.y = levelOne[i].y;

			blocks.push(block);
		}

		//	Set up objects to move around
		paddle.x = ((levelDimensions[0] / 2) - (levelDimensions[4] / 2));
		paddle.y = levelDimensions[1] - (levelDimensions[5]);

		shouldLoadLevel = false;
	}
}

function createContext()
{
	var canvas = document.getElementById("main.focus.canvas");
	return canvas.getContext("2d");
}

function fillScreen(str)
{
	var context = createContext();
	context.rect(0, 0, canvasWidth, canvasHeight);
	context.fillStyle = str;
	context.fill();
}

function blockTypeOne(x, y)
{
	var block;
	block.x = x;
	block.y = y;
	block.width = 20;
	block.height = 10;

	return block;
}

window.onload = function(){
	console.log("Javascript file loaded correctly");
	fillScreen("#ffffff");
	context = document.getElementById("main.focus.canvas").getContext("2d");

	timer = setInterval(main, 50);
};
